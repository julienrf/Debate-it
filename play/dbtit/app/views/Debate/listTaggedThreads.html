#{extends 'main.html' /}
#{set 'title'}Debate it!#{/set}
#{set 'moreStyles'}
	#{stylesheet 'pagination.sass' /}
#{/set}

<div>
	<h1>&{'tags'}</h1>
</div>


<div>
	#{list items: tags, as: 'tag'}
		<span class="tag">${tag}</span>
	#{/list}
</div>

#{if threads.size() > 0}
<div class="box">
	*{%{
		def showRoom = { thread ->
			'<a href="' + play.mvc.Router.reverse("Rooms.show", [hash: thread.room.hash]) + '" class="item-title">' + thread.room.name + '</a>'
		}
		def showThread = { thread ->
			'<a href="' + play.mvc.Router.reverse("Debate.showThread", [hash: thread.hash]) + '">' + thread.title + '</a>'
		}
		def lastPost = { thread -> post = thread.lastPost()
			post.author.name + ', ' + post.date.format("dd MMMM yyyy, HH'h'mm", lang) // TODO add user?._tz
		}
	}%
	#{dataview.table threads, columns: ['room': showRoom, 'thread': showThread, 'lastPost': lastPost] /}}*
	<table class="list">
	
		<tr class="item">
			<th>&{'room'}</th>
			<th>&{'thread'}</th>
			<th>&{'lastPost'}</th>
		</tr>
		
		#{list items:threads, as:'thread'}
			<tr class="item ${thread_parity}">
				<td>#{a @Rooms.show(thread.room.hash), class:'item-title'} ${thread.room.name} #{/a}</td>
				<td>#{a @Debate.showThread(thread.hash)} ${thread.title} #{/a}</td>
				%{ post = thread.lastPost() }%
				<td> ${post.author.name}, &{'at'} #{date date:post.date, tz: user?.tz /} </td>
			</tr>
		#{/list}
	
	</table>
</div>
#{/if}
#{else}
&{'noThread'}
#{/else}
